bias = 11.9; %mA
txGain = -10; %db
center_frequency = 5.5e8; %Hz

attenuation = [1.08,2.08,3.08,4.08,5.08,...
    6.08,7.08,8.08,9.08,10.08,...
    11.08,11.58,12.08,12.58,13.08,...
    13.58,14.08,14.58,15.08,15.58,...
    16.08,16.58,17.08,17.58,18.08,...
    18.58,18.78,18.98,19.18,19.38,...
    19.58,19.68,19.78,19.88,19.98,...
    20.08,20.18,20.28,20.38,20.48,...
    20.58,20.68,20.78,20.88,20.98,...
    21.18,21.38,21.58,21.78,21.98,...
    22.18,22.38,22.58,22.78,22.88,22.98];

BER = [0,0,0,0,0,...
    0,0,0,0,0,....
    0.001016483500000,0,0,0,0,...
    0,0,0,0,0,...
    0,0,2.747250000000000e-05,0.001483516500000,3.846154000000000e-04,...
    1.373626000000000e-04,0.001126373600000,7.692308000000000e-04,9.615385000000000e-04,0.002527472500000,...
    0.021868131900000,0.003873626400000,0.012692307700000,0.008269230800000,0.003076923100000,...
    0.012060439600000,0.023159340700000,0.013653846200000,0.025549450500000,0.022170329700000,...
    0.015741758200000,0.029313186800000,0.032005494500000,0.073736263700000,0.044038461500000,...
    0.082664835200000,0.087087912100000,0.099423076900000,0.083626373600000,0.095426632200000,...
    0.099786324800000,0.114368131900000,0.114631561300000,0.135398965300000,0.132967033000000,0.1730508241800000];


EVR = [0.114335669228817,0.110751196654695,0.163055818915461,0.114580316849160,0.120171378097774,...
    0.117495758190411,0.112061278275976,0.111966326853764,0.115305176226378,0.118503010306810,...
    0.176160669844941,0.130882400446910,0.150663369489891,0.142898599911168,0.143278941564925,...
    0.136937777588133,0.133574001257368,0.140081443766855,0.189548328317962,0.182465407550268,...
    0.190387963563212,0.245842131455568,0.264508771505667,0.261215269628148,0.310700157064743,...
    0.304625231248566,0.350326224437868,0.346099152127714,0.334837232416782,0.370860986112224,...
    0.594553015956407,0.402601128018910,0.499679405920276,0.457894552185083,0.387422712164306,...
    0.437162240650074,0.542776248787591,0.462079350604442,0.771841901801112,0.495932879444868,...
    0.535693545690364,0.679506719108110,0.946421299705264,1.116950091183157,0.640695462848564,...
    0.888004321485638,0.884512473446892,1.025500649114416,0.830138344191017,0.938536654129361,...
    1.009421034662712,0.994145919734058,1.041538115178974,1.036900036576672,1.160598757352974,1.386487137695775];

           
power_reception = -0.997272028811525.*attenuation -8.81758150300120;

attenuation_LDPC = [1.08,2.08,3.08,4.08,5.08,...
    6.08,7.08,8.08,9.08,10.08,...
    11.08,12.08,13.08,14.08,15.08,...
    16.08,17.08,17.58,18.08,18.58,...
    19.08,19.28,19.48,19.68,19.88,...
    20.08,20.28,20.48,20.68,20.88,...
    21.08,21.28,21.48,21.68,21.88,...
    22.08,22.28,22.48,22.68,22.88,...
    23.08,23.28,23.48,23.68];

BER_LDPC = [0,0,0,0,0,...
    0,0,0,0,0,...
    0,0,0,0,0,...
    0,8.928571000000000e-04,0,0,0,...
    0.002884615400000,0,8.791209000000000e-04,0,0,...
    0.001634615400000,0.009271978000000,0.019326923100000,0.004532967000000,0.002486263700000,...
    0.015906593400000,0.011414835200000,0.018406593400000,0.029423076900000,0.059189560400000,...
    0.077760989000000,0.043337912100000,0.080906593400000,0.058118131900000,0.079279930600000,...
    0.057321428600000,0.069215506700000,0.069822485200000,0.092678405900000];


EVR_LDPC = [0.151678238295876,0.127485939972192,0.113142366728963,0.111053502331402,0.115584591094454,...
    0.125555352862520,0.140266999649779,0.189991251351308,0.116557550698526,0.129030000292854,...
    0.120991112430314,0.150531326894034,0.152762000300846,0.181469776113846,0.166236772917726,...
    0.235888318944535,0.264810143189597,0.268616432278738,0.312798256002211,0.309653178201727,...
    0.482577008644412,0.354152629229677,0.395758274662309,0.276091894421064,0.434867368316974,...
    0.327820348017929,0.472276438570870,0.638508818330213,0.422255506428357,0.407315287086478,...
    0.596774404362553,0.797998311948916,0.606685452655446,0.838194321816887,0.935856742212257,...
    1.158280080046872,1.090475294965930,1.050798443004351,0.903720794973108,1.026255480000937,...
    0.977079161054429,1.029186231811316,1.181670559004062,1.080285458828975];

           
power_reception_LDPC = -0.997272028811525.*attenuation_LDPC -8.81758150300120;

Xq = -31.9:0.4:-10;
BER = fliplr(BER);
EVR = fliplr(EVR);
power_reception = fliplr(power_reception);
Vq_BER = interp1(power_reception,BER,Xq,'pchip');
Vq_EVR = interp1(power_reception,EVR,Xq,'pchip');


Xq_LDPC = -31.9:0.4:-10;
BER_LDPC = fliplr(BER_LDPC);
EVR_LDPC = fliplr(EVR_LDPC);
power_reception_LDPC = fliplr(power_reception_LDPC);
Vq_BER_LDPC = interp1(power_reception_LDPC,BER_LDPC,Xq_LDPC,'pchip');
Vq_EVR_LDPC = interp1(power_reception_LDPC,EVR_LDPC,Xq_LDPC,'pchip');


figure (1) 
plot(Xq,Vq_BER,'-*',Xq_LDPC,Vq_BER_LDPC,'-*');
title('BER function of received power for QPSK modulation');
xlabel('received power (dBm)');
ylabel('BER');
legend('without LDPC encoding','with LDPC encoding');

figure (2)
plot(Xq,Vq_EVR,'-*',Xq_LDPC,Vq_EVR_LDPC,'-*');
title('EVR function of received power for QPSK modulation');
xlabel('received power (dBm)');
ylabel('EVR');
legend('without LDPC encoding','with LDPC encoding');

%correlation between EVR and BER%
L = 2;
M = 4;

figure (3)
[EVR_sorted,index] = sort(EVR);

P_b = (2*(1-(1/L)))/log2(L) * qfunc(sqrt( ((3*log2(L)) / (L^2-1) ) * (2./EVR_sorted.^2*log2(M))));

for i = 1 : 1: length(index)
    BER_sorted(i) = BER(index(i));
end 


plot(EVR_sorted,P_b,'o',EVR_sorted,BER_sorted,'*');
title('BER function of EVR for QPSK modulation');
xlabel('EVR');
ylabel('BER');
legend('theoric','measured');



